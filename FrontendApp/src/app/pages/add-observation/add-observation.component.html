<div class="add-observation-container">
  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>Dodaj nową obserwację</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="observationForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Wybierz ptaka</mat-label>
            <mat-select formControlName="birdId" required>
              <mat-option *ngFor="let bird of birds" [value]="bird.id">
                {{ bird.commonName }} ({{ bird.scientificName }})
              </mat-option>
            </mat-select>
            <mat-error *ngIf="observationForm.get('birdId')?.hasError('required')">
              Wybór ptaka jest wymagany
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Data obserwacji</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="observationDate" [max]="today">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="observationForm.get('observationDate')?.hasError('required')">
              Data obserwacji jest wymagana
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Liczba zaobserwowanych ptaków</mat-label>
            <input matInput type="number" formControlName="numberOfBirds" min="1">
            <mat-error *ngIf="observationForm.get('numberOfBirds')?.hasError('min')">
              Liczba ptaków musi być większa niż 0
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Warunki pogodowe</mat-label>
            <input matInput formControlName="weatherConditions" maxlength="100">
            <mat-hint>np. słonecznie, 20°C</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Siedlisko</mat-label>
            <input matInput formControlName="habitat" maxlength="100">
            <mat-hint>np. las liściasty, park miejski</mat-hint>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Opis obserwacji</mat-label>
            <textarea matInput formControlName="description" rows="4"></textarea>
          </mat-form-field>
        </div>

        <div class="map-container">
          <h3>Wybierz lokalizację na mapie</h3>
          <app-map
            [initialLocation]="{ lat: 52.2297, lng: 21.0122 }"
            [initialZoom]="6"
            (locationSelected)="onLocationSelected($event)">
          </app-map>
          <div class="coordinates-info" *ngIf="selectedLocation">
            <p>Wybrana lokalizacja:</p>
            <p>Szerokość: {{ selectedLocation.lat | number:'1.4-4' }}</p>
            <p>Długość: {{ selectedLocation.lng | number:'1.4-4' }}</p>
          </div>
        </div>

        <div class="form-actions">
          <button mat-button type="button" routerLink="/observations" [disabled]="isSubmitting">
            Anuluj
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!observationForm.valid || !selectedLocation || isSubmitting">
            <mat-spinner diameter="20" *ngIf="isSubmitting"></mat-spinner>
            <span *ngIf="!isSubmitting">Dodaj obserwację</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
